<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register | Executive Discovery Workshops</title>
  <meta name="description" content="Register for our Business Blueprint program starting June 03, 2025. Transform your entrepreneurial vision into reality with our comprehensive 8-week course.">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script src="https://www.paypal.com/sdk/js?client-id=AcSoXi_goLU6xR0RD4Zu7FyfXd2gTDasE8UuHPvZHc67ygZ_-ealtDV8Sbf2JgsRmT_STFhVf8ReGgw1&vault=true&intent=subscription" data-sdk-integration-source="button-factory"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1040927487999789');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1040927487999789&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->


  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "ro69kpq5uz");
</script>
  <style>
    /* Styles specific to the registration page layout/form if not in styles.css */
    .registration-container {
      display: grid;
      grid-template-columns: 1fr; /* Default single column */
      gap: var(--space-xl); /* Use CSS variable for gap */
      align-items: start;
      padding-top: var(--space-xl); /* Add padding above */
      padding-bottom: var(--space-xl); /* Add padding below */
    }

    @media (min-width: 992px) { /* Match breakpoint in styles.css */
      .registration-container {
        grid-template-columns: 2fr 1fr; /* Two columns on larger screens */
      }
    }

    .registration-form {
      background-color: var(--neutral-100); /* Use CSS variable */
      padding: var(--space-xl); /* Use CSS variable */
      border-radius: var(--radius-md); /* Use CSS variable */
      box-shadow: var(--shadow-md); /* Use CSS variable */
    }

     .registration-form h2,
     .registration-form h3 {
        font-size: var(--font-size-xl); /* Use CSS variable */
        color: var(--primary-dark); /* Use CSS variable */
        margin-bottom: var(--space-lg); /* Use CSS variable */
        padding-bottom: var(--space-sm);
        border-bottom: 1px solid var(--neutral-300);
     }
     .registration-form h2.form-title { /* Specific class for main title if needed */
         text-align: center;
         border-bottom: none;
         margin-bottom: var(--space-md);
     }


    .registration-details {
      background-color: var(--neutral-200); /* Use CSS variable */
      padding: var(--space-lg); /* Use CSS variable */
      border-radius: var(--radius-md); /* Use CSS variable */
      box-shadow: var(--shadow-sm); /* Use CSS variable */
      position: sticky;
      top: 80px; /* Adjust based on header height (60px) + desired gap */
    }

     @media (max-width: 991px) { /* Match breakpoint in styles.css */
        .registration-details {
            position: static; /* Disable sticky on smaller screens */
            margin-top: var(--space-lg);
        }
    }

    .registration-details h3 {
        font-size: var(--font-size-lg); /* Use CSS variable */
        color: var(--primary-dark);
        margin-bottom: var(--space-md);
        padding-bottom: var(--space-sm);
        border-bottom: 1px solid var(--neutral-300);
    }

    .detail-item { margin-bottom: var(--space-lg); }
    .detail-item h4 {
        font-size: var(--font-size-base); /* Use CSS variable */
        font-weight: 600;
        margin-bottom: var(--space-xs);
        display: flex;
        align-items: center;
        color: var(--primary-dark);
     }
    .detail-item h4 i {
        margin-right: var(--space-sm);
        color: var(--primary-accent);
        width: 1.25em; /* Relative width */
        text-align: center;
     }
    .detail-item p {
        margin-bottom: var(--space-xs);
        color: var(--neutral-600);
        font-size: var(--font-size-sm);
        padding-left: calc(1.25em + var(--space-sm)); /* Indent text */
        line-height: 1.4;
     }
    .detail-item strong { color: var(--neutral-800); }
    .detail-item a {
        color: var(--primary-accent);
        text-decoration: underline;
    }
    .detail-item a:hover {
        color: #2d8bc0; /* Slightly darker accent */
    }


    /* Form element styling */
    .form-group {
      margin-bottom: var(--space-lg);
    }

    .form-group label {
      display: block;
      margin-bottom: var(--space-sm);
      font-weight: 500;
      color: var(--neutral-700);
    }

    .required {
      color: #ef4444; /* Keep a distinct required color */
      margin-left: var(--space-xs);
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 0.75rem 1rem; /* Adjust padding */
      border: 1px solid var(--neutral-400); /* Use CSS variable */
      border-radius: var(--radius-sm); /* Use CSS variable */
      font-size: var(--font-size-base); /* Use CSS variable */
      color: var(--neutral-800);
      background-color: var(--neutral-100);
      transition: border-color var(--transition-fast);
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-accent); /* Use CSS variable */
      box-shadow: 0 0 0 2px rgba(71, 167, 223, 0.3); /* Subtle focus ring */
    }

    /* Radio button styling */
    .payment-options-container {
      margin-top: var(--space-sm);
    }
    .radio-option {
      display: flex;
      align-items: center;
      margin-bottom: var(--space-sm);
      background-color: var(--neutral-100);
      padding: var(--space-md);
      border-radius: var(--radius-sm);
      border: 1px solid var(--neutral-300);
      cursor: pointer;
      transition: border-color var(--transition-fast), background-color var(--transition-fast);
    }
     .radio-option:hover {
        border-color: var(--neutral-400);
     }
     .radio-option input[type="radio"] {
        width: 1.1em; /* Slightly larger radio */
        height: 1.1em;
        margin-right: var(--space-md);
        flex-shrink: 0;
        accent-color: var(--primary-accent); /* Modern way to color radios */
     }
     .radio-option label {
        margin-bottom: 0;
        flex-grow: 1;
        cursor: pointer;
        color: var(--neutral-700);
        font-weight: 400;
     }
     /* Style for checked state */
      .radio-option input[type="radio"]:checked + label {
          font-weight: 500;
          color: var(--primary-dark);
      }
      .radio-option:has(input:checked) {
          border-color: var(--primary-accent);
          background-color: #f0f9ff; /* Very light blue */
      }


    /* Button specific styles for the form if needed */
    #submitButton {
        /* Use btn classes defined in styles.css */
        width: 100%; /* Make button full width */
        margin-top: var(--space-lg);
    }

    /* Payment options section */
    .payment-options {
      display: none; /* Hidden by default */
      margin-top: var(--space-xl);
      padding: var(--space-lg);
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-md);
      background-color: var(--neutral-200); /* Light background */
    }
     .payment-options h3 {
        font-size: var(--font-size-lg);
        margin-bottom: var(--space-md);
     }
     .payment-options p {
         font-size: var(--font-size-sm);
         color: var(--neutral-600);
         margin-bottom: var(--space-lg);
     }


    /* Message styling */
    .message {
        padding: var(--space-md);
        margin-bottom: var(--space-lg);
        border-radius: var(--radius-sm);
        font-weight: 500;
        border: 1px solid transparent;
    }
    .success-message {
        background-color: #dcfce7; /* Lighter green */
        color: #166534; /* Darker green */
        border-color: #86efac;
    }
    .error-message {
        background-color: #fee2e2; /* Lighter red */
        color: #991b1b; /* Darker red */
        border-color: #fca5a5;
    }

    /* PayPal Button Container */
    #paypalButtonContainer {
        margin-top: var(--space-md);
        min-height: 50px; /* Prevent layout shift */
    }
    #paypalButtonContainer p { /* Style processing message */
        text-align: center;
        font-weight: 600;
        color: var(--primary-dark);
        padding: var(--space-lg) 0;
    }

  </style>
</head>
<body>

  <header class="site-header">
    <div class="container">
      <div class="logo">
        <a href="/">Executive Discovery Workshops</a>
      </div>
      <nav class="main-navigation">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/about.html">About the Program</a></li>
          <li><a href="/business-blueprint.html">Business Blueprint</a></li>
          <li><a href="/schedule.html">Workshop Schedule</a></li>
          <li><a href="/curriculum.html">Curriculum</a></li>
          <li><a href="/register.html" class="active">Register</a></li>
          </ul>
      </nav>
      <button class="mobile-menu-toggle">
        <span class="sr-only">Menu</span>
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>

  <main>
    <section class="page-header">
      <div class="container">
        <h1>Register for Business Blueprint</h1>
        <p>Secure your spot in our upcoming cohort starting June 03, 2025.</p>
      </div>
    </section>

    <div class="container registration-container">

      <div class="registration-form">
        <h2 class="form-title">Secure Your Spot</h2>

        <p style="font-size: var(--font-size-sm); color: var(--neutral-600); margin-bottom: var(--space-lg);"> Complete the form below to register for the Business Blueprint program. After submission, you'll be shown payment options to confirm your registration.
        </p>

        <div id="successMessage" class="message success-message" style="display: none;">
          Your registration details have been received. Please complete the payment below to finalize your enrollment.
        </div>

        <div id="errorMessage" class="message error-message" style="display: none;">
          There was an error. Please check your details or try again later.
        </div>

        <div id="emailErrorMessage" class="message error-message" style="display: none;">
          Payment successful, but we encountered an issue sending the confirmation email. Please contact support. Your registration is confirmed.
        </div>

        <form id="registrationForm">
          <h3>Personal Information</h3>
          <div class="form-group">
            <label for="fullName">Full Name <span class="required">*</span></label>
            <input type="text" id="fullName" name="fullName" required>
          </div>
          <div class="form-group">
            <label for="email">Email Address <span class="required">*</span></label>
            <input type="email" id="email" name="email" required>
          </div>
          <div class="form-group">
            <label for="phone">Phone Number <span class="required">*</span></label>
            <input type="tel" id="phone" name="phone" required>
          </div>
          <div class="form-group">
            <label for="address">Home Address <span class="required">*</span></label>
            <textarea id="address" name="address" rows="3" required></textarea>
          </div>

          <h3>Business Information</h3>
          <div class="form-group">
            <label for="businessExperience">Business Experience Level <span class="required">*</span></label>
            <select id="businessExperience" name="businessExperience" required>
              <option value="">Select your experience level</option>
              <option value="No experience">No experience</option>
              <option value="Some experience">Some experience (less than 2 years)</option>
              <option value="Experienced">Experienced (2-5 years)</option>
              <option value="Very experienced">Very experienced (5+ years)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="businessDescription">Describe Your Business, If You Have One. If Not, Describe Your Job, and Business Ideas <span class="required">*</span></label>
            <textarea id="businessDescription" name="businessDescription" rows="4" required></textarea>
          </div>
          <div class="form-group">
            <label for="businessGoals">Main Goals for the Program <span class="required">*</span></label>
            <textarea id="businessGoals" name="businessGoals" rows="4" required></textarea>
          </div>

          <h3>Referral Information</h3>
          <div class="form-group">
              <label for="referralSource">How did you hear about us? <span class="required">*</span></label>
              <select id="referralSource" name="referralSource" required>
                  <option value="">-- Select an option --</option>
                  <option value="Social Media (LinkedIn, Facebook, etc.)">Social Media (LinkedIn, Facebook, etc.)</option>
                  <option value="Friend or Colleague">Friend or Colleague</option>
                  <option value="Search Engine (Google, Bing, etc.)">Search Engine (Google, Bing, etc.)</option>
                  <option value="Online Advertisement">Online Advertisement</option>
                  <option value="Email Newsletter">Email Newsletter</option>
                  <option value="Event or Workshop">Event or Workshop</option>
                  <option value="Other">Other</option>
              </select>
          </div>
          <div class="form-group">
              <label for="referralName">Referred by (Name, if applicable):</label>
              <input type="text" id="referralName" name="referralName" placeholder="Enter name if referred by someone">
          </div>

          <h3>Payment Options</h3>
          <p style="font-size: var(--font-size-sm); color: var(--neutral-600); margin-bottom: var(--space-md);">Select your preferred payment option:</p>
          <div class="payment-options-container">
            <div class="radio-option">
              <input type="radio" id="oneTimePayment" name="paymentOption" value="onetime" checked>
              <label for="oneTimePayment">One-time payment ($600 CAD)</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="monthlyPayment" name="paymentOption" value="monthly">
              <label for="monthlyPayment">Monthly payments (2 x $300 CAD)</label>
            </div>
          </div>

          <button type="submit" id="submitButton" class="btn btn-primary">
              Proceed to Payment
          </button>
        </form>

        <div id="paymentOptions" class="payment-options">
          <h3>Complete Your Registration</h3>
          <p>To secure your spot in the Business Blueprint program, please complete your payment using the PayPal button below.</p>
          <div id="paypalButtonContainer">
             </div>
        </div>
      </div>

      <div class="registration-details">
        <h3>Program Details</h3>
        <div class="detail-item">
          <h4><i class="fas fa-calendar-alt fa-fw"></i> Program Dates</h4>
          <p>June 03 - July 22, 2025</p>
          <p>8 weekly sessions held every Tuesday at 7:30 PM EST</p>
        </div>
        <div class="detail-item">
          <h4><i class="fas fa-dollar-sign fa-fw"></i> Investment</h4>
          <p><strong>$600 CAD</strong> total (one-time)</p>
          <p>or <strong>2 payments of $300 CAD</strong> (monthly)</p>
          <p>Includes all course materials, session recordings, templates, and access to our private community forum.</p>
        </div>
        <div class="detail-item">
          <h4><i class="fas fa-user-friends fa-fw"></i> Limited Capacity</h4>
          <p>We limit each training to MAXIMUM 25 participants to ensure personalized attention and feedback.</p>
        
        </div>
        <div class="detail-item">
          <h4><i class="fas fa-question-circle fa-fw"></i> Have Questions?</h4>
          <p>Contact us at <a href="mailto:info@executivediscovery.com">info@executivediscovery.com</a> to speak with our team.</p>
        </div>
        <a href="/business-blueprint.html" class="btn btn-secondary" style="display: block; width: 100%; margin-top: var(--space-lg);">Learn More About the Program</a>
      </div>

    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-logo">
          <h3>Executive Discovery Workshops</h3>
          <p>Transforming aspiring entrepreneurs into successful executives</p>
        </div>
        <div class="footer-links">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/about.html">About the Program</a></li>
            <li><a href="/business-blueprint.html">Business Blueprint</a></li>
            <li><a href="/schedule.html">Workshop Schedule</a></li>
            <li><a href="/curriculum.html">Curriculum</a></li>
            <li><a href="/register.html">Register</a></li>
          </ul>
        </div>
        <div class="footer-contact">
          <h4>Contact Us</h4>
          <p><i class="fas fa-envelope"></i> info@executivediscovery.ca</p>
          <div class="social-links">
            <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Executive Discovery Workshops. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

    <script>
    // --- Configuration ---
    const EMAILJS_SERVICE_ID = 'service_lnrg1h1';
    const EMAILJS_TEMPLATE_ID = 'template_aehp1ev';
    const EMAILJS_PUBLIC_KEY = 'QzPU4nIsl3TTDh4xn';
    const PAYPAL_ONETIME_PAYMENT_LINK = 'https://www.paypal.com/ncp/payment/AXV4GWZH3HCGG'; // Your direct payment link
    const PAYPAL_PLAN_ID_MONTHLY = 'P-75L54121H53220933M72SWBQ'; // Your subscription plan ID
    const THANK_YOU_PAGE_URL = 'https://executivediscovery.ca/thankyou.html'; // Your thank you page

    // --- Element References ---
    const registrationForm = document.getElementById('registrationForm');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    const emailErrorMessage = document.getElementById('emailErrorMessage'); // Keep this for email sending errors
    const paymentOptionsDiv = document.getElementById('paymentOptions');
    const paypalButtonContainer = document.getElementById('paypalButtonContainer');
    const paymentOptionRadios = document.querySelectorAll('input[name="paymentOption"]');
    const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    const siteHeader = document.querySelector('.site-header');

    // --- State Variable ---
    // We don't strictly need to store registrationData globally anymore with this approach,
    // but it doesn't hurt if other parts might use it later.
    let registrationData = null;

    // --- Initialize EmailJS ---
    (function(){
        try {
            emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
        } catch(e) {
            console.error("Failed to initialize EmailJS:", e);
            // Maybe display a persistent error on the page?
        }
    })();

    // --- Functions ---

    /**
     * Sends registration data using EmailJS.
     * Triggered immediately after form submission in this version.
     * Does NOT handle redirection itself.
     */
    function sendRegistrationEmail(dataToSend) {
      if (!dataToSend) {
        console.error('No registration data provided to send.');
        emailErrorMessage.textContent = 'An unexpected error occurred (missing data for email). Please try again.';
        emailErrorMessage.style.display = 'block';
        return; // Stop if no data
      }

      console.log('Sending registration email with data:', dataToSend);
      emailErrorMessage.style.display = 'none'; // Hide previous email errors

      emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, dataToSend)
        .then(function(response) {
           console.log('EmailJS SUCCESS!', response.status, response.text);
           // Email sent successfully. User proceeds to payment UI.
           // No redirect here. Redirect happens after PayPal interaction.
        }, function(error) {
           console.error('EmailJS FAILED...', error);
           // Show the specific email error message
           emailErrorMessage.textContent = 'Registration details saved, but we encountered an issue sending the confirmation email. Please check your details or contact support if you don\'t receive it. You can proceed with payment.';
           emailErrorMessage.style.display = 'block';
           // IMPORTANT: Let the user continue to payment even if email fails here.
        });
    }

    /**
     * Renders the appropriate PayPal button/link based on the selected payment option.
     */
    function renderPayPalButton() {
        const selectedOption = document.querySelector('input[name="paymentOption"]:checked').value;
        paypalButtonContainer.innerHTML = ''; // Clear previous button/content
        errorMessage.style.display = 'none'; // Hide general PayPal errors before rendering

        console.log(`Rendering PayPal UI for option: ${selectedOption}`);

        // --- Configuration for One-Time Payment (Direct Link) ---
        if (selectedOption === 'onetime') {
            console.log(`Configuring for One-Time Payment using Link: ${PAYPAL_ONETIME_PAYMENT_LINK}`);

            const paymentLinkButton = document.createElement('a');
            paymentLinkButton.href = PAYPAL_ONETIME_PAYMENT_LINK;
            paymentLinkButton.textContent = 'Pay $600 CAD Now with PayPal';
            paymentLinkButton.target = '_blank';
            paymentLinkButton.rel = 'noopener noreferrer';
            paymentLinkButton.classList.add('btn', 'btn-primary');
            paymentLinkButton.style.display = 'inline-block';
            paymentLinkButton.style.width = '100%';
            paymentLinkButton.style.textAlign = 'center';
            paymentLinkButton.style.marginTop = 'var(--space-md)';
            paypalButtonContainer.appendChild(paymentLinkButton);
            console.log("Direct payment link button rendered.");
            // NOTE: User needs to click this link. Redirect happens via PayPal's Return URL setting.

        // --- Configuration for Monthly Subscription (Standard JS SDK Button) ---
        } else if (selectedOption === 'monthly') {
            const planId = PAYPAL_PLAN_ID_MONTHLY;
            console.log(`Configuring for Subscription: Plan ID ${planId}`);

            try {
                paypal.Buttons({
                    style: {
                        shape: 'rect',
                        color: 'gold',
                        layout: 'vertical',
                        label: 'subscribe',
                        tagline: false
                    },
                    createSubscription: function(data, actions) {
                        console.log('Creating subscription for plan ID:', planId);
                        return actions.subscription.create({
                            plan_id: planId
                        });
                    },
                    onApprove: function(data, actions) {
                        // Subscription approved!
                        console.log('PayPal subscription approved:', data);
                        paypalButtonContainer.innerHTML = '<p>Subscription processing, please wait...</p>';
                        // ** Email was ALREADY sent earlier **
                        // Redirect to thank you page AFTER approval.
                        window.location.href = THANK_YOU_PAGE_URL;
                    },
                    onError: function (err) {
                        // Handles errors for the subscription button rendering or process
                        console.error('PayPal Button Error (Subscription):', err);
                        errorMessage.textContent = 'An error occurred with the PayPal subscription setup. Please try again or contact support.';
                        errorMessage.style.display = 'block';
                        // Attempt to re-render the button if it fails loading initially
                        renderPayPalButton();
                    },
                    onCancel: function (data) {
                        // Handles user cancelling the subscription flow on PayPal's site
                        console.log('PayPal subscription cancelled:', data);
                        errorMessage.textContent = 'Subscription cancelled. You can select an option and try again.';
                        errorMessage.style.display = 'block';
                    }
                }).render('#paypalButtonContainer');
            } catch (error) {
                console.error("Error rendering PayPal JS SDK Button (Subscription): ", error);
                paypalButtonContainer.innerHTML = '<p class="message error-message">Error loading subscription payment option. Please refresh the page or contact support.</p>';
                errorMessage.style.display = 'block'; // Show general error message div
            }
        } else {
            console.error("No valid payment option selected.");
            paypalButtonContainer.innerHTML = '<p class="message error-message">Please select a payment option.</p>';
            errorMessage.style.display = 'block';
        }
    }

    // --- Event Listeners ---

    // Mobile Menu Toggle
    if (mobileMenuToggle && siteHeader) {
        mobileMenuToggle.addEventListener('click', function() {
            siteHeader.classList.toggle('menu-open');
        });
    } else {
        console.warn('Mobile menu toggle button or site header element not found.');
    }

    // Form Submission Handler - Sends email immediately, then shows payment UI
    registrationForm.addEventListener('submit', function(e) {
      e.preventDefault();

      // Hide messages on new submission attempt
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      emailErrorMessage.style.display = 'none';

      // Basic form validation check
      if (!this.checkValidity()) {
        const firstInvalidField = this.querySelector(':invalid');
        if (firstInvalidField) {
            firstInvalidField.focus();
        }
        this.reportValidity();
        return;
      }

      // --- Gather form data ---
      const formData = new FormData(this);
      registrationData = {}; // Prepare data object
      formData.forEach((value, key) => {
          registrationData[key] = value;
      });
      const selectedOptionRadio = document.querySelector('input[name="paymentOption"]:checked');
      const selectedLabel = selectedOptionRadio ? selectedOptionRadio.nextElementSibling.textContent : 'Not specified';
      registrationData.paymentOption = selectedLabel.trim(); // Add payment choice text to data

      console.log('Form data captured:', registrationData);

      // --- SEND EMAIL IMMEDIATELY ---
      // This happens BEFORE the user interacts with PayPal.
      // User gets email even if they don't complete payment.
      console.log("Sending confirmation email NOW, before payment interaction...");
      sendRegistrationEmail(registrationData);

      // --- Update UI ---
      this.style.display = 'none'; // Hide the form
      successMessage.textContent = 'Your registration details have been received and a confirmation email is being sent. Please complete the payment below to finalize your enrollment.'; // Update text slightly
      successMessage.style.display = 'block'; // Show success message
      paymentOptionsDiv.style.display = 'block'; // Show the payment container div

      // --- Render the correct PayPal UI (Link or Button) ---
      renderPayPalButton();

      // Scroll to payment section
      paymentOptionsDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    // Update PayPal button/link if the payment option changes *after* the form is submitted
    paymentOptionRadios.forEach(radio => {
      radio.addEventListener('change', function() {
        // Only re-render if the payment section is already visible
        if (paymentOptionsDiv.style.display === 'block') {
          console.log('Payment option changed, re-rendering PayPal UI.');
          renderPayPalButton(); // Call the function to show the correct button/link
        }
      });
    });

  </script>
</body>
</html>
